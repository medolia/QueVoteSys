<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Page</title>
</head>
<body>

<span class="option0">Que Melodia</span>
<span class="option0">0</span>
<span class="option2">0</span>
<p class="vote-timer-container">Remaining time: <span class="vote-timer">20</span> second</p>
<input class="form-submit-btn" type="submit" value="提交">

</body>

<script src=js/query-3.5.1.min.js type="text/javascript"></script>
<script type="text/javascript">

    $(function() {

        const voteTimer = setInterval(function () {
            let currentTime = $(".vote-timer").text();
            $(".vote-timer").text(parseInt(currentTime) - 1);
        }, 1000);

        const voteTimeout = setTimeout(cancelVoteAccess, 20000);

        let now = new Date().getTime();
        let startTime = localStorage.getItem("startTime");

        if (localStorage.getItem("startTime") == null) {
            localStorage.setItem("startTime", now);
        } else {
            if ((now - startTime) >= 20000) {
                $(".vote-timer").text(0);
                cancelVoteAccess();
                // localStorage.removeItem("startTime");
            }
        }

        function cancelVoteAccess() {
            clearInterval(voteTimer);
            $(".form-submit-btn").attr("disabled", "disabled");
        };



    });

</script>
<!--<script type="text/javascript">



    $(document).ready(function() {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/results",
            // contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                let tempVal = $("span.option2").text();
                let tempNum = parseInt(tempVal);
                console.log(tempVal + " -> " + (tempNum+1).toString());
                $("span.option2").text(tempNum);
                let option_id = 0;
                let voteNum = 0;
                $.each(data, function (i, answer) {
                    option_id = answer["option_id"];
                    /*voteNum =  $(".option0").text();
                    console.log(voteNum);*/
                    voteNum = $(".option" + option_id ).text();
                    // console.log(voteNum);
                    $("#option" + option_id).text(voteNum.toString());
                });
            },
            error: function (result) {
                alert(result.responseText);
            }
        });
    });

</script>-->
<!--<script type="text/javascript">

    $(document).ready(function() {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/results",
            // contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                let option_id = 0;
                let optNumSumList = [];
                $.each(data, function (index, answer) {
                    option_id = answer["option_id"];
                    let optNotExsit =  optUpdate(option_id, optNumSumList);
                    if (optNotExsit) {
                        optNumSumList.push(new OptNumSum((option_id, 1)));
                    }
                });

                $.each(optNumSumList, function (index, optNumSum) {
                    $("#option" + optNumSum.option_id).text(optNumSum.voteNum);
                })

            },
            error: function (result) {
                alert(result.responseText);
            }
        });
    });

    function OptNumSum(option_id, voteNum) {
        this.option_id = option_id;
        this.voteNum = voteNum;
    }

    function optUpdate(option_id, optNumSumList) {
        optNumSumList.forEach(function(value, index) {
            if (value.option_id == option_id) {
                value.voteNum += 1;
                return false;
            }
        });

        return true;
    }

</script>-->

</html>